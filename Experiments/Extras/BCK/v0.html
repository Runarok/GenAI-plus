<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üéâ Happy Birthday Greeting Card üéâ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="https://raw.githubusercontent.com/Runarok/GenAI-plus/main/GenAI-plus.png" type="image/png">
  <style>
    :root {
      --dark-bg: #16161a;
      --dark-card: #22223b;
      --dark-text: #fffffe;
      --dark-accent: #ff8906;
      --dark-btn-bg: #232946;
      --dark-btn-text: #fffffe;
      --dark-input-bg: #232946;
      --dark-input-text: #fffffe;

      --light-bg: #fff7f0;
      --light-card: #ffe6e6;
      --light-text: #22223b;
      --light-accent: #ff006e;
      --light-btn-bg: #ffe6e6;
      --light-btn-text: #22223b;
      --light-input-bg: #fff;
      --light-input-text: #22223b;

      --transition: background 0.3s, color 0.3s;
      --font-main: 'Segoe UI', 'Helvetica Neue', Arial, 'Liberation Sans', sans-serif;
      --font-card: 'Pacifico', cursive, 'Comic Sans MS', cursive;
    }

    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: var(--font-main);
      background: var(--dark-bg);
      color: var(--dark-text);
      transition: var(--transition);
      min-height: 100vh;
      box-sizing: border-box;
    }

    body.light {
      background: var(--light-bg);
      color: var(--light-text);
    }

    .container {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      justify-content: center;
      align-items: center;
      padding: 2rem 1rem;
    }

    header {
      margin-bottom: 1rem;
      text-align: center;
    }

    .theme-toggle {
      position: absolute;
      top: 1rem;
      right: 1rem;
      z-index: 2;
      display: flex;
      align-items: center;
      gap: 0.5em;
      font-size: 1rem;
      background: none;
      border: none;
      color: inherit;
      cursor: pointer;
    }

    .card {
      background: var(--dark-card);
      color: var(--dark-text);
      max-width: 420px;
      margin: 1rem auto;
      border-radius: 25px;
      padding: 2.5rem 2rem 2rem 2rem;
      box-shadow: 0 8px 24px rgba(0,0,0,0.24);
      text-align: center;
      min-height: 230px;
      position: relative;
      font-family: var(--font-card);
      font-size: 1.3rem;
      letter-spacing: 0.01em;
      transition: var(--transition);
      overflow: visible;
    }

    body.light .card {
      background: var(--light-card);
      color: var(--light-text);
      box-shadow: 0 6px 16px rgba(255, 0, 110, 0.09);
    }

    .greeting-controls {
      margin-bottom: 1.5rem;
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      justify-content: center;
      align-items: flex-end;
      width: 100%;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      min-width: 170px;
    }

    .form-group label {
      font-size: 1rem;
      margin-bottom: 0.4em;
      color: inherit;
    }

    select, input[type="text"] {
      padding: 0.5em 0.7em;
      border-radius: 7px;
      border: none;
      font-size: 1rem;
      background: var(--dark-input-bg);
      color: var(--dark-input-text);
      outline: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      margin-bottom: 0.2em;
      transition: var(--transition);
      width: 100%;
    }

    body.light select, body.light input[type="text"] {
      background: var(--light-input-bg);
      color: var(--light-input-text);
    }

    .actions {
      display: flex;
      flex-direction: row;
      gap: 1em;
      justify-content: center;
      margin-top: 0.8em;
    }

    button {
      background: var(--dark-btn-bg);
      color: var(--dark-btn-text);
      padding: 0.55em 1.3em;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      cursor: pointer;
      font-family: var(--font-main);
      font-weight: 500;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      transition: var(--transition), box-shadow 0.2s;
      outline: none;
    }

    button:active {
      transform: scale(0.98);
    }

    body.light button {
      background: var(--light-btn-bg);
      color: var(--light-btn-text);
    }

    .quote-display {
      margin: 0 auto 1.5rem auto;
      position: relative;
      z-index: 1;
      min-height: 130px;
      width: 100%;
      font-size: 1.25em;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      line-height: 1.5;
      padding: 0.5em 0.2em 0.5em 0.2em;
    }

    .card .balloons {
      position: absolute;
      top: -54px;
      left: 50%;
      transform: translateX(-50%);
      width: 170px;
      pointer-events: none;
      z-index: 2;
    }

    .card .cake {
      position: absolute;
      bottom: -35px;
      left: 50%;
      transform: translateX(-50%);
      width: 105px;
      z-index: 2;
      pointer-events: none;
    }

    /* Confetti Animation */
    .confetti {
      pointer-events: none;
      position: fixed;
      left: 0; top: 0; width: 100vw; height: 100vh;
      z-index: 30;
      overflow: hidden;
      display: block;
      pointer-events: none;
    }

    /* Responsive Design */
    @media (max-width: 600px) {
      .container { padding: 1rem 0.2rem; }
      .card {
        max-width: 99vw;
        padding: 1.5rem 0.6rem 1.3rem 0.6rem;
        font-size: 1.08rem;
      }
      .greeting-controls { gap: 0.6rem; }
      .form-group { min-width: 110px; }
      .card .balloons { width: 110px; top: -34px; }
      .card .cake { width: 66px; bottom: -22px;}
    }
  </style>
  <!-- Google Fonts for Pacifico -->
  <link href="https://fonts.googleapis.com/css?family=Pacifico&display=swap" rel="stylesheet">
</head>
<body>
  <button class="theme-toggle" id="themeToggle" title="Toggle theme">
    <span id="themeIcon" aria-label="Switch theme" style="font-size:1.3em;">üåô</span>
    <span id="themeLabel">Dark</span>
  </button>
  <div class="container">
    <header>
      <h1 style="margin-bottom:0.2em;font-family:var(--font-card);font-size:2.2em;letter-spacing:0.01em;">üéÇ Happy Birthday! üéà</h1>
      <p style="font-size:1.08em;color:var(--dark-accent);margin:0 0 0.2em 0;font-weight:500;">Create your own personalized greeting card</p>
    </header>
    <div class="greeting-controls" id="controls">
      <div class="form-group">
        <label for="nameInput">Recipient's Name</label>
        <input type="text" id="nameInput" maxlength="24" placeholder="e.g., Alex" autocomplete="off">
      </div>
      <div class="form-group">
        <label for="quoteSelect">Birthday Quote</label>
        <select id="quoteSelect"></select>
      </div>
      <div class="form-group" style="align-items:center;">
        <label style="opacity:0;user-select:none;">&nbsp;</label>
        <button id="randomBtn" title="Pick a random quote">üé≤ Random Quote</button>
      </div>
      <div class="form-group" style="align-items:center;">
        <label style="opacity:0;user-select:none;">&nbsp;</label>
        <button id="copyLinkBtn" title="Copy personalized card link">üîó Copy Link</button>
      </div>
    </div>
    <div class="card" id="greetingCard">
      <img class="balloons" src="https://cdn.jsdelivr.net/gh/hjnilsson/country-flags/svg/balloons.svg" alt="Balloons" onerror="this.style.display='none'">
      <div class="quote-display" id="quoteDisplay"></div>
      <img class="cake" src="https://cdn.pixabay.com/photo/2017/01/31/13/14/birthday-2028658_1280.png" alt="Birthday Cake" onerror="this.style.display='none'">
    </div>
    <canvas class="confetti" id="confetti" width="1" height="1" aria-hidden="true"></canvas>
  </div>
  <script>
    // Quotes with [NAME] placeholder
    const BIRTHDAY_QUOTES = [
      "Happy Birthday, [NAME]! üéâ Wishing you a day filled with laughter, joy, and cake.",
      "To [NAME]: May your birthday be as bright and wonderful as you are! ü•≥",
      "Cheers to you, [NAME]! üéÇ May your year ahead sparkle with happiness.",
      "Sending smiles and big hugs to [NAME] on your special day! üéà",
      "Wishing [NAME] a birthday that's just as sweet as you are. üç∞",
      "Another adventure-filled year awaits you, [NAME]! Happy Birthday! üöÄ",
      "[NAME], may your cake be sweet and your presents be plenty! üéÅ",
      "Happy Birthday, [NAME]! May your day be surrounded by love and magic. ‚ú®",
      "[NAME], here's to more amazing memories and countless blessings. Happy Birthday! üéä",
      "Let the confetti fly! [NAME], it's your day to shine. üéâ"
    ];

    // DOM Elements
    const body = document.body;
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    const themeLabel = document.getElementById('themeLabel');
    const nameInput = document.getElementById('nameInput');
    const quoteSelect = document.getElementById('quoteSelect');
    const quoteDisplay = document.getElementById('quoteDisplay');
    const randomBtn = document.getElementById('randomBtn');
    const copyLinkBtn = document.getElementById('copyLinkBtn');
    const card = document.getElementById('greetingCard');
    const confettiCanvas = document.getElementById('confetti');
    let currentTheme = 'dark';

    // Utility: Base64 encode/decode (URL-safe)
    function b64encode(str) {
      return btoa(unescape(encodeURIComponent(str)))
        .replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
    }
    function b64decode(str) {
      str = str.replace(/-/g, '+').replace(/_/g, '/');
      while (str.length % 4) str += '=';
      return decodeURIComponent(escape(atob(str)));
    }

    // ---- Confetti Animation ----
    // Simple, performant confetti
    function launchConfetti() {
      const W = window.innerWidth, H = window.innerHeight, ctx = confettiCanvas.getContext('2d');
      confettiCanvas.width = W; confettiCanvas.height = H;
      let pieces = [];
      for (let i = 0; i < 70; i++) {
        pieces.push({
          x: Math.random()*W,
          y: Math.random()*-H,
          w: Math.random()*8+6,
          h: Math.random()*10+10,
          r: Math.random()*360,
          d: Math.random()*0.8+0.7,
          color: ["#ff8906","#ff006e","#ffd803","#6fff95","#00aaff","#fbbf24","#ffffff"][Math.floor(Math.random()*7)]
        });
      }
      let frame = 0, maxFrames = 110;
      (function animate() {
        ctx.clearRect(0,0,W,H);
        pieces.forEach(p=>{
          ctx.save();
          ctx.translate(p.x, p.y);
          ctx.rotate(p.r*Math.PI/180);
          ctx.fillStyle = p.color;
          ctx.fillRect(-p.w/2,-p.h/2,p.w,p.h);
          ctx.restore();
          p.y += p.d*3.5 + Math.random()*1.1;
          p.x += Math.sin(frame/7 + p.d*3)*0.7;
          p.r += p.d*3;
          if (p.y > H+20) p.y = Math.random()*-40, p.x = Math.random()*W;
        });
        frame++;
        if (frame < maxFrames)
          requestAnimationFrame(animate);
        else ctx.clearRect(0,0,W,H);
      })();
    }

    // ---- Theme Handling ----
    function setTheme(theme, persist=true) {
      body.classList.toggle('light', theme === 'light');
      currentTheme = theme;
      themeIcon.textContent = theme === 'light' ? '‚òÄÔ∏è' : 'üåô';
      themeLabel.textContent = theme.charAt(0).toUpperCase() + theme.slice(1);
      if (persist) localStorage.setItem('birthday_theme', theme);
    }

    function getInitialTheme() {
      const saved = localStorage.getItem('birthday_theme');
      if (saved === 'light' || saved === 'dark') return saved;
      // Try system dark mode
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) return 'dark';
      return 'dark';
    }

    themeToggle.addEventListener('click', () => {
      const next = (currentTheme === 'dark') ? 'light' : 'dark';
      setTheme(next);
      updateURL();
    });

    // ---- Populate Quote Select Menu ----
    function populateQuotesMenu() {
      quoteSelect.innerHTML = '';
      BIRTHDAY_QUOTES.forEach((q, i) => {
        let opt = document.createElement('option');
        opt.value = i;
        opt.textContent = q.replace('[NAME]', '______').replace(/üéâ|üéà|üéÇ|ü•≥|üç∞|üöÄ|üéÅ|‚ú®|üéä/g, '').replace(/\s+/g, ' ').trim();
        quoteSelect.appendChild(opt);
      });
    }

    // ---- Random Quote Selection ----
    function pickRandomQuote() {
      let idx = Math.floor(Math.random() * BIRTHDAY_QUOTES.length);
      quoteSelect.selectedIndex = idx;
      onSelectionChanged();
    }

    randomBtn.addEventListener('click', e => {
      e.preventDefault();
      pickRandomQuote();
      launchConfetti();
    });

    // ---- Quote & Name Handling ----
    function getSelectedQuoteIdx() {
      return quoteSelect.selectedIndex >= 0 ? quoteSelect.selectedIndex : 0;
    }
    function getSelectedQuote() {
      return BIRTHDAY_QUOTES[getSelectedQuoteIdx()];
    }
    function getEnteredName() {
      let n = nameInput.value.trim();
      if (!n) return 'Friend';
      // Limit name to 24 chars, only letters/spaces/dash allowed
      return n.replace(/[^A-Za-z√Ä-√ø \-']/g, '').slice(0,24) || 'Friend';
    }
    function personalizeQuote(q, name) {
      return q.replace(/\[NAME\]/g, name);
    }

    // ---- Display Greeting Card ----
    function showGreetingCard() {
      let quote = getSelectedQuote();
      let name = getEnteredName();
      let cardText = personalizeQuote(quote, name);
      quoteDisplay.innerHTML = cardText;
    }

    // ---- Encoding/Decoding URL Parameters ----
    function encodeCardParams() {
      let idx = getSelectedQuoteIdx();
      let name = getEnteredName();
      let theme = currentTheme;
      // Compose as JSON, then encode
      let obj = { q: idx, n: name, t: theme };
      let json = JSON.stringify(obj);
      return b64encode(json);
    }

    function decodeCardParams(str) {
      try {
        let obj = JSON.parse(b64decode(str));
        if (typeof obj.q === 'number' && obj.n && (obj.t === 'dark' || obj.t === 'light')) {
          return obj;
        }
      } catch (e) {}
      return null;
    }

    // ---- Update URL ----
    function updateURL() {
      // Use URL hash to avoid reloads
      let encoded = encodeCardParams();
      window.history.replaceState(null, '', `#${encoded}`);
    }

    // ---- Copy Link ----
    copyLinkBtn.addEventListener('click', () => {
      let url = window.location.origin + window.location.pathname + '#' + encodeCardParams();
      navigator.clipboard.writeText(url).then(() => {
        copyLinkBtn.textContent = '‚úÖ Copied!';
        setTimeout(() => copyLinkBtn.textContent = 'üîó Copy Link', 1300);
      });
    });

    // ---- Event Handlers ----
    function onSelectionChanged() {
      showGreetingCard();
      updateURL();
    }
    nameInput.addEventListener('input', onSelectionChanged);
    quoteSelect.addEventListener('change', onSelectionChanged);

    // ---- Handle Page Load with Encoded Params ----
    function loadFromURL() {
      const hash = window.location.hash.replace(/^#/, '');
      if (hash.length > 0) {
        let data = decodeCardParams(hash);
        if (data) {
          setTheme(data.t, false);
          quoteSelect.selectedIndex = Math.max(0, Math.min(BIRTHDAY_QUOTES.length-1, data.q));
          nameInput.value = data.n;
          showGreetingCard();
          setTimeout(()=>launchConfetti(), 650);
          return true;
        }
      }
      return false;
    }

    // ---- Initialization ----
    function init() {
      setTheme(getInitialTheme(), false);
      populateQuotesMenu();
      // Try to load from hash. If not, pick random and default name
      if (!loadFromURL()) {
        nameInput.value = '';
        pickRandomQuote();
        showGreetingCard();
      }
    }

    // Listen for hashchange (for sharing)
    window.addEventListener('hashchange', () => {
      loadFromURL();
    });

    // Resize confetti canvas on resize
    window.addEventListener('resize', ()=>{
      confettiCanvas.width = window.innerWidth;
      confettiCanvas.height = window.innerHeight;
    });

    // ---- Start ----
    init();
  </script>
</body>
</html>