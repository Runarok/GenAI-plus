<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryoShift</title>
    <style>
        :root {
            --frost-accent: #00eaff;
            --frost-accent2: #00b8cc;
            --frost-accent3: #0088ff;
            --frost-panel-dark: rgba(26, 35, 48, 0.85);
            --frost-panel-light: rgba(255, 255, 255, 0.85);
            --frost-txt-dark: #e0e0e0;
            --frost-txt-light: #1a2330;
            --frost-shadow: 0 4px 32px 0 #00eaff33;
            --frost-panel-blur: blur(12px);
            --frost-transition: 0.3s ease;
        }

        body {
            margin: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #1a2330 0%, #0a1620 100%);
            font-family: 'Inter', sans-serif;
            color: var(--frost-txt-dark);
        }

        .game-container {
            position: relative;
            width: 400px;
            height: 400px;
            background: var(--frost-panel-dark);
            border-radius: 12px;
            box-shadow: var(--frost-shadow);
            backdrop-filter: var(--frost-panel-blur);
            padding: 20px;
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            width: 100%;
            height: 100%;
        }

        .tile {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            color: var(--frost-accent);
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .tile::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.1));
            pointer-events: none;
        }

        .tile.merged {
            animation: merge-pulse 0.3s ease;
        }

        @keyframes merge-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .score-panel {
            position: absolute;
            top: -60px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            padding: 10px;
            background: var(--frost-panel-dark);
            border-radius: 8px;
            box-shadow: var(--frost-shadow);
        }

        .score, .high-score {
            font-size: 18px;
            color: var(--frost-accent);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="score-panel">
            <div class="score">Score: <span id="score">0</span></div>
            <div class="high-score">High: <span id="highScore">0</span></div>
        </div>
        <div class="game-board" id="gameBoard"></div>
    </div>

    <script>
        class CryoShift {
            constructor() {
                this.board = Array(4).fill().map(() => Array(4).fill(0));
                this.score = 0;
                this.highScore = localStorage.getItem('cryoshiftHighScore') || 0;
                this.init();
            }

            init() {
                this.addNewTile();
                this.addNewTile();
                this.updateDisplay();
                this.setupEventListeners();
            }

            addNewTile() {
                const emptyCells = [];
                for (let i = 0; i < 4; i++) {
                    for (let j = 0; j < 4; j++) {
                        if (this.board[i][j] === 0) {
                            emptyCells.push({x: i, y: j});
                        }
                    }
                }
                if (emptyCells.length > 0) {
                    const randomCell = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                    this.board[randomCell.x][randomCell.y] = Math.random() < 0.9 ? -10 : -20;
                }
            }

            updateDisplay() {
                const gameBoard = document.getElementById('gameBoard');
                gameBoard.innerHTML = '';
                
                for (let i = 0; i < 4; i++) {
                    for (let j = 0; j < 4; j++) {
                        const tile = document.createElement('div');
                        tile.className = 'tile';
                        if (this.board[i][j] !== 0) {
                            tile.textContent = this.board[i][j] + 'Â°C';
                        }
                        gameBoard.appendChild(tile);
                    }
                }

                document.getElementById('score').textContent = this.score;
                document.getElementById('highScore').textContent = this.highScore;
            }

            setupEventListeners() {
                document.addEventListener('keydown', (e) => {
                    let moved = false;
                    switch(e.key) {
                        case 'ArrowUp':
                            moved = this.moveUp();
                            break;
                        case 'ArrowDown':
                            moved = this.moveDown();
                            break;
                        case 'ArrowLeft':
                            moved = this.moveLeft();
                            break;
                        case 'ArrowRight':
                            moved = this.moveRight();
                            break;
                    }
                    if (moved) {
                        this.addNewTile();
                        this.updateDisplay();
                        if (this.isGameOver()) {
                            alert('Game Over! Score: ' + this.score);
                        }
                    }
                });
            }

            moveLeft() {
                return this.move(row => {
                    const newRow = row.filter(cell => cell !== 0);
                    for (let i = 0; i < newRow.length - 1; i++) {
                        if (newRow[i] === newRow[i + 1]) {
                            newRow[i] *= 2;
                            this.score += Math.abs(newRow[i]);
                            newRow.splice(i + 1, 1);
                        }
                    }
                    while (newRow.length < 4) newRow.push(0);
                    return newRow;
                });
            }

            moveRight() {
                return this.move(row => {
                    const newRow = row.filter(cell => cell !== 0);
                    for (let i = newRow.length - 1; i > 0; i--) {
                        if (newRow[i] === newRow[i - 1]) {
                            newRow[i] *= 2;
                            this.score += Math.abs(newRow[i]);
                            newRow.splice(i - 1, 1);
                            i--;
                        }
                    }
                    while (newRow.length < 4) newRow.unshift(0);
                    return newRow;
                });
            }

            moveUp() {
                return this.move(col => {
                    const newCol = col.filter(cell => cell !== 0);
                    for (let i = 0; i < newCol.length - 1; i++) {
                        if (newCol[i] === newCol[i + 1]) {
                            newCol[i] *= 2;
                            this.score += Math.abs(newCol[i]);
                            newCol.splice(i + 1, 1);
                        }
                    }
                    while (newCol.length < 4) newCol.push(0);
                    return newCol;
                }, true);
            }

            moveDown() {
                return this.move(col => {
                    const newCol = col.filter(cell => cell !== 0);
                    for (let i = newCol.length - 1; i > 0; i--) {
                        if (newCol[i] === newCol[i - 1]) {
                            newCol[i] *= 2;
                            this.score += Math.abs(newCol[i]);
                            newCol.splice(i - 1, 1);
                            i--;
                        }
                    }
                    while (newCol.length < 4) newCol.unshift(0);
                    return newCol;
                }, true);
            }

            move(moveFunction, isVertical = false) {
                const oldBoard = JSON.stringify(this.board);
                
                if (isVertical) {
                    for (let j = 0; j < 4; j++) {
                        const column = this.board.map(row => row[j]);
                        const newColumn = moveFunction(column);
                        for (let i = 0; i < 4; i++) {
                            this.board[i][j] = newColumn[i];
                        }
                    }
                } else {
                    for (let i = 0; i < 4; i++) {
                        this.board[i] = moveFunction([...this.board[i]]);
                    }
                }

                if (JSON.stringify(this.board) !== oldBoard) {
                    this.score += Math.abs(this.board[0][0]);
                    if (this.score > this.highScore) {
                        this.highScore = this.score;
                        localStorage.setItem('cryoshiftHighScore', this.highScore);
                    }
                }

                return JSON.stringify(this.board) !== oldBoard;
            }

            isGameOver() {
                return this.board.some(row => row.some(cell => cell === 0));
            }

            isGameWon() {
                return this.board.some(row => row.some(cell => cell === 100));
            }

            getGameState() {
                return {
                    board: this.board,
                    score: this.score,
                    highScore: this.highScore
                };
            }

            loadGameState(state) {
                this.board = state.board;
                this.score = state.score;
                this.highScore = state.highScore;
                this.updateDisplay();
            }
        }

        const game = new CryoShift();
    </script>
</body>
</html>

