<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brightness Gradient Image Editor</title>
    <link rel="icon" href="https://raw.githubusercontent.com/Runarok/GenAI-plus/main/GenAI-plus.png" type="image/png">
    <style>
        :root {
            --primary-color: #2196F3;
            --primary-hover: #1976D2;
            --primary-active: #1565C0;
            --bg-primary: #f5f5f5;
            --bg-secondary: #ffffff;
            --text-primary: #212121;
            --text-secondary: #757575;
            --border-color: #e0e0e0;
            --success-color: #4CAF50;
            --error-color: #f44336;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
        }

        body {
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 32px;
            text-align: center;
        }

        h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .subtitle {
            font-size: 0.95rem;
            color: var(--text-secondary);
            font-weight: 400;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        .section {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 24px;
            box-shadow: var(--shadow);
            transition: box-shadow 0.2s ease;
        }

        .section:hover {
            box-shadow: var(--shadow-lg);
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .icon {
            font-size: 1.2rem;
        }

        /* Drop Zone */
        .drop-zone {
            border: 3px dashed var(--border-color);
            border-radius: 8px;
            padding: 48px 24px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.02) 0%, rgba(33, 150, 243, 0.05) 100%);
            margin-bottom: 16px;
        }

        .drop-zone:hover {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.05) 0%, rgba(33, 150, 243, 0.1) 100%);
        }

        .drop-zone.drag-over {
            border-color: var(--primary-color);
            background: linear-gradient(135deg, rgba(33, 150, 243, 0.1) 0%, rgba(33, 150, 243, 0.15) 100%);
            transform: scale(1.02);
        }

        .drop-zone-icon {
            font-size: 2.5rem;
            margin-bottom: 12px;
            display: block;
            color: var(--primary-color);
        }

        .drop-zone-text {
            font-size: 1rem;
            color: var(--text-primary);
            font-weight: 500;
            margin-bottom: 4px;
        }

        .drop-zone-subtext {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        #fileInput {
            display: none;
        }

        /* Canvas */
        .canvas-wrapper {
            position: relative;
            background: #f9f9f9;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 450px;
        }

        canvas {
            display: block;
            border-radius: 4px;
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .gradient-line {
            position: absolute;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent 0%, rgba(255, 255, 255, 0.8) 50%, transparent 100%);
            cursor: row-resize;
            z-index: 10;
            box-shadow: 0 0 4px rgba(0, 0, 0, 0.3);
        }

        .gradient-line.dragging {
            background: linear-gradient(90deg, transparent 0%, rgba(76, 175, 80, 0.9) 50%, transparent 100%);
            height: 4px;
        }

        .gradient-point {
            position: absolute;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 3px solid white;
            cursor: grab;
            z-index: 11;
            left: 50%;
            transform: translateX(-50%);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s ease;
        }

        .gradient-point:hover {
            transform: translateX(-50%) scale(1.2);
        }

        .gradient-point.dragging {
            cursor: grabbing;
            transform: translateX(-50%) scale(1.3);
        }

        .gradient-point.top {
            background: rgba(33, 150, 243, 0.9);
        }

        .gradient-point.bottom {
            background: rgba(76, 175, 80, 0.9);
        }

        .canvas-placeholder {
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-align: center;
            padding: 20px;
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.5);
        }

        /* Controls */
        .controls-section {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 24px;
            box-shadow: var(--shadow);
        }

        .control-group {
            margin-bottom: 24px;
        }

        .control-group:last-child {
            margin-bottom: 0;
        }

        .control-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .control-label-text {
            color: var(--text-primary);
        }

        .control-value {
            color: var(--primary-color);
            font-weight: 600;
            font-size: 0.95rem;
            background: rgba(33, 150, 243, 0.1);
            padding: 4px 10px;
            border-radius: 4px;
            min-width: 50px;
            text-align: center;
        }

        .slider-container {
            position: relative;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(to right, var(--border-color) 0%, var(--border-color) 100%);
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            cursor: pointer;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(33, 150, 243, 0.3);
            transition: all 0.2s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
        }

        input[type="range"]::-webkit-slider-thumb:active {
            transform: scale(1.25);
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 6px rgba(33, 150, 243, 0.3);
            transition: all 0.2s ease;
        }

        input[type="range"]::-moz-range-thumb:hover {
            transform: scale(1.15);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.4);
        }

        input[type="range"]::-moz-range-thumb:active {
            transform: scale(1.25);
        }

        /* Buttons */
        .button-group {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 24px;
        }

        button {
            flex: 1;
            min-width: 120px;
            padding: 12px 20px;
            border: none;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.3);
        }

        .btn-primary:active:not(:disabled) {
            background: var(--primary-active);
            transform: translateY(0);
        }

        .btn-secondary {
            background: var(--border-color);
            color: var(--text-primary);
        }

        .btn-secondary:hover:not(:disabled) {
            background: #d0d0d0;
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        /* Status Messages */
        .status-message {
            padding: 12px 16px;
            border-radius: 6px;
            font-size: 0.9rem;
            margin-bottom: 16px;
            display: none;
            animation: slideIn 0.3s ease;
        }

        .status-message.show {
            display: block;
        }

        .status-message.error {
            background: rgba(244, 67, 54, 0.1);
            color: var(--error-color);
            border-left: 4px solid var(--error-color);
        }

        .status-message.success {
            background: rgba(76, 175, 80, 0.1);
            color: var(--success-color);
            border-left: 4px solid var(--success-color);
        }

        .status-message.info {
            background: rgba(33, 150, 243, 0.1);
            color: var(--primary-color);
            border-left: 4px solid var(--primary-color);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Image Info */
        .image-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            padding: 12px;
            background: rgba(33, 150, 243, 0.05);
            border-radius: 6px;
            font-size: 0.85rem;
            margin-bottom: 16px;
            display: none;
        }

        .image-info.show {
            display: grid;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
        }

        .info-label {
            color: var(--text-secondary);
            font-weight: 500;
        }

        .info-value {
            color: var(--text-primary);
            font-weight: 600;
            font-family: 'Courier New', monospace;
        }

        /* Footer */
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 24px;
            border-top: 1px solid var(--border-color);
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        /* Loading State */
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(33, 150, 243, 0.3);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            body {
                padding: 12px;
            }

            h1 {
                font-size: 1.5rem;
            }

            .main-layout {
                gap: 16px;
            }

            .section, .controls-section {
                padding: 16px;
            }

            button {
                min-width: 100px;
                padding: 10px 16px;
                font-size: 0.85rem;
            }

            .button-group {
                gap: 8px;
            }

            .canvas-wrapper {
                min-height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚ú® Brightness Gradient Editor</h1>
            <p class="subtitle">Upload an image, apply a smooth brightness gradient, and download the result</p>
        </header>

        <div class="main-layout">
            <!-- Upload Section -->
            <div class="section">
                <div class="section-title">
                    <span class="icon">üì§</span>
                    <span>Upload Image</span>
                </div>
                
                <div id="statusMessage" class="status-message"></div>

                <div id="dropZone" class="drop-zone">
                    <span class="drop-zone-icon">üìÅ</span>
                    <div class="drop-zone-text">Drag & Drop your image here</div>
                    <div class="drop-zone-subtext">or click to browse</div>
                </div>

                <div id="imageInfo" class="image-info">
                    <div class="info-item">
                        <span class="info-label">Dimensions:</span>
                        <span class="info-value" id="infoDimensions">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">File Size:</span>
                        <span class="info-value" id="infoFileSize">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Format:</span>
                        <span class="info-value" id="infoFormat">-</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Aspect Ratio:</span>
                        <span class="info-value" id="infoRatio">-</span>
                    </div>
                </div>

                <input type="file" id="fileInput" accept="image/png,image/jpeg,image/webp,.png,.jpg,.jpeg,.webp" />

                <button class="btn-primary" id="resetBtn" disabled>
                    <span>üîÑ</span> Reset to Original
                </button>
            </div>

            <!-- Canvas Display -->
            <div class="section">
                <div class="section-title">
                    <span class="icon">üé®</span>
                    <span>Preview</span>
                </div>
                <div class="canvas-wrapper" id="canvasWrapper">
                    <canvas id="canvas"></canvas>
                    <div class="gradient-point top" id="topPoint" style="top: 10%;"></div>
                    <div class="gradient-point bottom" id="bottomPoint" style="bottom: 10%;"></div>
                    <div class="canvas-placeholder" id="canvasPlaceholder">
                        üì∏ Canvas will appear here
                    </div>
                </div>
            </div>
        </div>

        <!-- Controls Section -->
        <div class="controls-section">
            <div class="section-title">
                <span class="icon">üéõÔ∏è</span>
                <span>Brightness Gradient Controls</span>
            </div>

            <div class="control-group">
                <div class="control-label">
                    <span class="control-label-text">Top Brightness</span>
                    <span class="control-value" id="topBrightnessValue">0</span>
                </div>
                <div class="slider-container">
                    <input type="range" id="topBrightness" min="-100" max="100" value="0" disabled />
                </div>
            </div>

            <div class="control-group">
                <div class="control-label">
                    <span class="control-label-text">Bottom Brightness</span>
                    <span class="control-value" id="bottomBrightnessValue">0</span>
                </div>
                <div class="slider-container">
                    <input type="range" id="bottomBrightness" min="-100" max="100" value="0" disabled />
                </div>
            </div>

            <div class="button-group">
                <button class="btn-success" id="downloadBtn" disabled>
                    <span>üíæ</span> Download as PNG
                </button>
            </div>
        </div>

        <footer>
            <p>Built with ‚ù§Ô∏è ‚Ä¢ Brightness Gradient Image Editor v1.0</p>
        </footer>
    </div>

    <script>
        // State Management
        const state = {
            originalImage: null,
            originalImageData: null,
            canvas: document.getElementById('canvas'),
            ctx: null,
            isImageLoaded: false,
            topBrightness: 0,
            bottomBrightness: 0,
            gradientTopPercent: 10,
            gradientBottomPercent: 90,
            isDraggingTop: false,
            isDraggingBottom: false
        };

        // DOM Elements
        const elements = {
            dropZone: document.getElementById('dropZone'),
            fileInput: document.getElementById('fileInput'),
            canvas: document.getElementById('canvas'),
            canvasWrapper: document.getElementById('canvasWrapper'),
            canvasPlaceholder: document.getElementById('canvasPlaceholder'),
            statusMessage: document.getElementById('statusMessage'),
            imageInfo: document.getElementById('imageInfo'),
            topBrightness: document.getElementById('topBrightness'),
            bottomBrightness: document.getElementById('bottomBrightness'),
            topBrightnessValue: document.getElementById('topBrightnessValue'),
            bottomBrightnessValue: document.getElementById('bottomBrightnessValue'),
            topPoint: document.getElementById('topPoint'),
            bottomPoint: document.getElementById('bottomPoint'),
            resetBtn: document.getElementById('resetBtn'),
            downloadBtn: document.getElementById('downloadBtn')
        };

        // Initialize Canvas Context
        state.ctx = state.canvas.getContext('2d', { willReadFrequently: true });

        // Utility: Show Status Message
        function showStatus(message, type = 'info') {
            elements.statusMessage.textContent = message;
            elements.statusMessage.className = `status-message show ${type}`;
            setTimeout(() => {
                elements.statusMessage.classList.remove('show');
            }, 4000);
        }

        // Utility: Validate File
        function isValidImage(file) {
            const validTypes = ['image/png', 'image/jpeg', 'image/webp'];
            return file && validTypes.includes(file.type) && file.size > 0;
        }

        // Utility: Format File Size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + ' ' + sizes[i];
        }

        // Utility: Calculate Aspect Ratio String
        function getAspectRatioString(width, height) {
            const gcd = (a, b) => b === 0 ? a : gcd(b, a % b);
            const divisor = gcd(width, height);
            return `${width / divisor}:${height / divisor}`;
        }

        // Load Image and Display
        function loadImage(file) {
            if (!isValidImage(file)) {
                showStatus('Please upload a valid image (PNG, JPG, or WebP)', 'error');
                return;
            }

            const reader = new FileReader();

            reader.onload = (e) => {
                try {
                    const img = new Image();

                    img.onload = () => {
                        try {
                            // Reset brightness values
                            state.topBrightness = 0;
                            state.bottomBrightness = 0;
                            elements.topBrightness.value = 0;
                            elements.bottomBrightness.value = 0;
                            elements.topBrightnessValue.textContent = '0';
                            elements.bottomBrightnessValue.textContent = '0';

                            // Set canvas dimensions to match image
                            state.canvas.width = img.width;
                            state.canvas.height = img.height;

                            // Store original image
                            state.originalImage = img;
                            state.isImageLoaded = true;

                            // Draw original image to canvas
                            state.ctx.drawImage(img, 0, 0);

                            // Store original image data
                            state.originalImageData = state.ctx.getImageData(0, 0, state.canvas.width, state.canvas.height);

                            // Show canvas and hide placeholder
                            state.canvas.style.display = 'block';
                            elements.canvasPlaceholder.style.display = 'none';

                            // Show gradient points
                            elements.topPoint.style.display = 'block';
                            elements.bottomPoint.style.display = 'block';

                            // Enable controls
                            elements.topBrightness.disabled = false;
                            elements.bottomBrightness.disabled = false;
                            elements.resetBtn.disabled = false;
                            elements.downloadBtn.disabled = false;

                            // Update image info
                            updateImageInfo(img.width, img.height, file.size, file.type);

                            // Show success message
                            showStatus('‚úÖ Image loaded successfully!', 'success');
                        } catch (error) {
                            console.error('Error processing image:', error);
                            showStatus('Error processing image. Please try again.', 'error');
                        }
                    };

                    img.onerror = () => {
                        showStatus('Failed to load image. Please try a different file.', 'error');
                    };

                    img.src = e.target.result;
                } catch (error) {
                    console.error('Error reading file:', error);
                    showStatus('Error reading file. Please try again.', 'error');
                }
            };

            reader.onerror = () => {
                showStatus('Error reading file. Please try again.', 'error');
            };

            reader.readAsDataURL(file);
        }

        // Update Image Info Display
        function updateImageInfo(width, height, fileSize, fileType) {
            document.getElementById('infoDimensions').textContent = `${width} √ó ${height}px`;
            document.getElementById('infoFileSize').textContent = formatFileSize(fileSize);
            document.getElementById('infoFormat').textContent = fileType.split('/')[1].toUpperCase();
            document.getElementById('infoRatio').textContent = getAspectRatioString(width, height);
            elements.imageInfo.classList.add('show');
        }

        // Apply Brightness Gradient
        function applyBrightnessGradient() {
            if (!state.isImageLoaded || !state.originalImageData) return;

            try {
                // Create a copy of original image data
                const imageData = state.ctx.createImageData(state.originalImageData);
                const data = imageData.data;
                const originalData = state.originalImageData.data;

                const height = state.canvas.height;
                const topPixel = (state.gradientTopPercent / 100) * height;
                const bottomPixel = (state.gradientBottomPercent / 100) * height;
                const gradientRange = bottomPixel - topPixel;

                // Process each pixel
                for (let i = 0; i < originalData.length; i += 4) {
                    // Calculate pixel index (0-based)
                    const pixelIndex = i / 4;
                    const pixelRow = Math.floor(pixelIndex / state.canvas.width);

                    // Calculate gradient interpolation based on custom gradient line positions
                    let gradientProgress = 0;
                    if (pixelRow <= topPixel) {
                        gradientProgress = 0;
                    } else if (pixelRow >= bottomPixel) {
                        gradientProgress = 1;
                    } else {
                        gradientProgress = (pixelRow - topPixel) / gradientRange;
                    }

                    // Linear interpolation of brightness values
                    const brightness = state.topBrightness + (state.bottomBrightness - state.topBrightness) * gradientProgress;

                    // Apply brightness adjustment (scale: -100 to +100)
                    const factor = 1 + brightness / 100;

                    // Get original RGB values
                    const r = originalData[i];
                    const g = originalData[i + 1];
                    const b = originalData[i + 2];
                    const a = originalData[i + 3];

                    // Apply brightness and clamp to 0-255
                    data[i] = Math.max(0, Math.min(255, Math.round(r * factor)));
                    data[i + 1] = Math.max(0, Math.min(255, Math.round(g * factor)));
                    data[i + 2] = Math.max(0, Math.min(255, Math.round(b * factor)));
                    data[i + 3] = a;
                }

                // Put modified image data back on canvas
                state.ctx.putImageData(imageData, 0, 0);
            } catch (error) {
                console.error('Error applying brightness gradient:', error);
                showStatus('Error applying effect. Please try again.', 'error');
            }
        }

        // Reset to Original Image
        function resetImage() {
            if (!state.originalImage) return;

            try {
                state.topBrightness = 0;
                state.bottomBrightness = 0;
                elements.topBrightness.value = 0;
                elements.bottomBrightness.value = 0;
                elements.topBrightnessValue.textContent = '0';
                elements.bottomBrightnessValue.textContent = '0';

                // Redraw original
                state.ctx.drawImage(state.originalImage, 0, 0);
                state.originalImageData = state.ctx.getImageData(0, 0, state.canvas.width, state.canvas.height);

                showStatus('üîÑ Reset to original image', 'success');
            } catch (error) {
                console.error('Error resetting image:', error);
                showStatus('Error resetting image.', 'error');
            }
        }

        // Download Image as PNG
        function downloadImage() {
            if (!state.isImageLoaded) {
                showStatus('No image to download', 'error');
                return;
            }

            try {
                const link = document.createElement('a');
                link.href = state.canvas.toDataURL('image/png');
                link.download = `brightness-gradient-${new Date().getTime()}.png`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showStatus('üíæ Image downloaded successfully!', 'success');
            } catch (error) {
                console.error('Error downloading image:', error);
                showStatus('Error downloading image. Please try again.', 'error');
            }
        }

        // Event Listeners: Drop Zone
        elements.dropZone.addEventListener('click', () => {
            elements.fileInput.click();
        });

        elements.dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            e.stopPropagation();
            elements.dropZone.classList.add('drag-over');
        });

        elements.dropZone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            e.stopPropagation();
            elements.dropZone.classList.remove('drag-over');
        });

        elements.dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            e.stopPropagation();
            elements.dropZone.classList.remove('drag-over');

            const files = e.dataTransfer.files;
            if (files.length > 0) {
                loadImage(files[0]);
            }
        });

        // Event Listeners: File Input
        elements.fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                loadImage(e.target.files[0]);
            }
        });

        // Event Listeners: Brightness Sliders
        elements.topBrightness.addEventListener('input', (e) => {
            state.topBrightness = parseInt(e.target.value);
            elements.topBrightnessValue.textContent = state.topBrightness;
            applyBrightnessGradient();
        });

        elements.bottomBrightness.addEventListener('input', (e) => {
            state.bottomBrightness = parseInt(e.target.value);
            elements.bottomBrightnessValue.textContent = state.bottomBrightness;
            applyBrightnessGradient();
        });

        // Gradient Point Dragging
        function startDragging(isTop) {
            return (e) => {
                e.preventDefault();
                if (isTop) {
                    state.isDraggingTop = true;
                    elements.topPoint.classList.add('dragging');
                } else {
                    state.isDraggingBottom = true;
                    elements.bottomPoint.classList.add('dragging');
                }
            };
        }

        function handleMouseMove(e) {
            const wrapper = elements.canvasWrapper;
            const rect = wrapper.getBoundingClientRect();
            const y = e.clientY - rect.top;
            const percent = Math.max(0, Math.min(100, (y / rect.height) * 100));

            if (state.isDraggingTop && percent < state.gradientBottomPercent - 5) {
                state.gradientTopPercent = percent;
                elements.topPoint.style.top = percent + '%';
                elements.topPoint.style.bottom = 'auto';
                applyBrightnessGradient();
            }

            if (state.isDraggingBottom && percent > state.gradientTopPercent + 5) {
                state.gradientBottomPercent = percent;
                elements.bottomPoint.style.bottom = (100 - percent) + '%';
                elements.bottomPoint.style.top = 'auto';
                applyBrightnessGradient();
            }
        }

        function stopDragging() {
            state.isDraggingTop = false;
            state.isDraggingBottom = false;
            elements.topPoint.classList.remove('dragging');
            elements.bottomPoint.classList.remove('dragging');
        }

        // Event Listeners: Gradient Points
        elements.topPoint.addEventListener('mousedown', startDragging(true));
        elements.bottomPoint.addEventListener('mousedown', startDragging(false));
        document.addEventListener('mousemove', handleMouseMove);
        document.addEventListener('mouseup', stopDragging);

        // Touch Support for Gradient Points
        elements.topPoint.addEventListener('touchstart', startDragging(true));
        elements.bottomPoint.addEventListener('touchstart', startDragging(false));
        document.addEventListener('touchmove', (e) => {
            if (state.isDraggingTop || state.isDraggingBottom) {
                const touch = e.touches[0];
                const mouseEvent = new MouseEvent('mousemove', {
                    clientY: touch.clientY
                });
                handleMouseMove(mouseEvent);
            }
        });
        document.addEventListener('touchend', stopDragging);

        // Event Listeners: Buttons
        elements.resetBtn.addEventListener('click', resetImage);
        elements.downloadBtn.addEventListener('click', downloadImage);

        // Prevent default drag and drop behavior on document
        document.addEventListener('dragover', (e) => {
            e.preventDefault();
            e.stopPropagation();
        });

        document.addEventListener('drop', (e) => {
            e.preventDefault();
            e.stopPropagation();
        });

        // Initial placeholder display
        state.canvas.style.display = 'none';
        elements.topPoint.style.display = 'none';
        elements.bottomPoint.style.display = 'none';
    </script>
</body>
</html>
