<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JS Object/JSON Formatter & Fixer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Favicon -->
  <link rel="icon" href="https://raw.githubusercontent.com/Runarok/GenAI-plus/main/GenAI-plus.png" type="image/png">
  <style>
    html, body {
      margin: 0; padding: 0; height: 100%;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #fafbfc;
    }
    .container {
      display: flex;
      height: 100vh;
      min-height: 400px;
    }
    .pane {
      flex: 1;
      padding: 2rem;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      background: #fff;
    }
    .pane.left {
      border-right: 1px solid #ececec;
      background: #f7f9fa;
    }
    .pane.right {
      background: #fff;
    }
    .pane label {
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #2b2f33;
    }
    .pane textarea {
      flex: 1;
      width: 100%;
      min-height: 180px;
      resize: none;
      font-size: 1rem;
      font-family: 'JetBrains Mono', 'Fira Mono', 'Menlo', monospace;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      padding: 1rem;
      background: #f9fafb;
      box-sizing: border-box;
      outline: none;
    }
    .pane textarea:focus {
      border: 1.5px solid #4f8cff;
      background: #fff;
    }
    .pane pre {
      white-space: pre-wrap;
      word-break: break-word;
      background: #f8f8fa;
      color: #23272e;
      font-size: 1rem;
      border-radius: 6px;
      padding: 1rem;
      margin: 0;
      min-height: 180px;
      border: 1px solid #ececec;
    }
    .errors {
      margin-top: 1rem;
      background: #fff4e6;
      color: #d9480f;
      border: 1px solid #ffd8a8;
      border-radius: 6px;
      padding: 1rem 1rem 0.2rem 1rem;
      font-size: 1rem;
    }
    .errors span {
      display: block;
      margin-bottom: 0.5em;
    }
    .mark {
      background: #fff3bf;
      color: #d9480f;
      padding: 0.1em 0.3em;
      border-radius: 3px;
    }
    @media (max-width: 800px) {
      .container { flex-direction: column; }
      .pane { min-height: 40vh; padding: 1rem; }
      .pane.left { border-right: none; border-bottom: 1px solid #ececec; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="pane left">
      <label for="input">Input JS Object / JSON (malformed allowed):</label>
      <textarea id="input" spellcheck="false" placeholder="Paste JS object or JSON here...">
{
  foo: 'bar', 
  name: John, 
  list: [ 1,2,3, ], 
  extra: , 
  trailing: 123,, 
  missingBracket: [1,2,3,
  bad: {x:1,,y:2:}
}
      </textarea>
    </div>
    <div class="pane right">
      <label for="output">Corrected &amp; Formatted Output:</label>
      <pre id="output"></pre>
      <div class="errors" id="errors" style="display:none"></div>
    </div>
  </div>
  <script>
    // Utility to escape HTML
    function escapeHtml(str) {
      return str.replace(/[<>&]/g, ch => ({
        '<': '&lt;', '>': '&gt;', '&': '&amp;'
      }[ch]));
    }
    // Main fixer and formatter
    function fixAndFormat(input) {
      let original = input;
      let errors = [];
      let fixed = input;

      // 1. Replace single quotes with double quotes (only for string values)
      if (/'/.test(fixed)) {
        fixed = fixed.replace(/'([^']*)'/g, function(m, p1) {
          return '"' + p1.replace(/"/g, '\\"') + '"';
        });
        errors.push('<span class="mark">Single quotes</span> replaced with double quotes for string values.');
      }

      // 2. Add quotes to unquoted keys (very basic heuristic)
      fixed = fixed.replace(/([{,]\s*)([a-zA-Z0-9_\-$]+)\s*:/g, function(m, p1, p2) {
        if (!/^["']/.test(p2)) {
          errors.push(`<span class="mark">Unquoted key</span> <mark>${p2}</mark> quoted.`);
          return p1 + '"' + p2 + '":';
        }
        return m;
      });

      // 3. Remove extra commas (before } or ] and double commas)
      let pre = fixed;
      fixed = fixed.replace(/,\s*([}\]])/g, '$1');
      if (pre !== fixed) errors.push('<span class="mark">Trailing commas</span> before } or ] removed.');

      pre = fixed;
      fixed = fixed.replace(/,(\s*,)+/g, ',');
      if (pre !== fixed) errors.push('<span class="mark">Double commas</span> replaced with single comma.');

      // 4. Remove empty values after colons or commas (e.g. "key: ,", "key:}")
      pre = fixed;
      fixed = fixed.replace(/:\s*(,|[}\]])/g, ':null$1');
      if (pre !== fixed) errors.push('<span class="mark">Missing values</span> replaced with <mark>null</mark>.');

      // 5. Remove extra colons (e.g. y:2: becomes y:2)
      pre = fixed;
      fixed = fixed.replace(/:\s*([^,}\]]+):/g, ':$1');
      if (pre !== fixed) errors.push('<span class="mark">Extra colons</span> deleted.');

      // 6. Fix unclosed brackets/braces by balancing counts
      let openCurly = (fixed.match(/{/g)||[]).length, closeCurly = (fixed.match(/}/g)||[]).length;
      let openSquare = (fixed.match(/\[/g)||[]).length, closeSquare = (fixed.match(/]/g)||[]).length;
      if (openCurly > closeCurly) {
        fixed += '}'.repeat(openCurly - closeCurly);
        errors.push('<span class="mark">Missing }</span> added to balance curly braces.');
      }
      if (openSquare > closeSquare) {
        fixed += ']'.repeat(openSquare - closeSquare);
        errors.push('<span class="mark">Missing ]</span> added to balance square brackets.');
      }
      if (openCurly < closeCurly) {
        fixed = fixed.replace(/}$/, '');
        errors.push('<span class="mark">Extra }</span> removed.');
      }
      if (openSquare < closeSquare) {
        fixed = fixed.replace(/]$/, '');
        errors.push('<span class="mark">Extra ]</span> removed.');
      }

      // 7. Try to parse as JSON
      try {
        let parsed = JSON.parse(fixed);
        return {
          output: escapeHtml(JSON.stringify(parsed, null, 2)),
          errors
        };
      } catch (e) {
        // Try Function constructor fallback for JS objects (dangerous)
        try {
          // eslint-disable-next-line no-new-func
          let parsed = (new Function('return (' + fixed + ')'))();
          return {
            output: escapeHtml(JSON.stringify(parsed, null, 2)),
            errors: errors.concat([
              `<span class="mark">Warning:</span> Used JS eval fallback. Input wasn't valid JSON, but could be interpreted as a JS object. Please check the output.`
            ])
          };
        } catch (e2) {
          return {
            output: '',
            errors: errors.concat([
              `<span class="mark">Parse error:</span> Could not parse as JSON or JS object. Please check your input.`
            ])
          };
        }
      }
    }

    const $input = document.getElementById('input');
    const $output = document.getElementById('output');
    const $errors = document.getElementById('errors');
    function process() {
      const input = $input.value;
      if (!input.trim()) {
        $output.textContent = '';
        $errors.style.display = 'none';
        return;
      }
      const {output, errors} = fixAndFormat(input);
      $output.innerHTML = output || '';
      if (errors.length > 0) {
        $errors.innerHTML = errors.join('');
        $errors.style.display = '';
      } else {
        $errors.innerHTML = '';
        $errors.style.display = 'none';
      }
    }
    $input.addEventListener('input', process);
    process();
  </script>
</body>
</html>