<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>JS Object/JSON Formatter & Fixer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
      background: #fafbfc;
    }
    .container {
      display: flex;
      flex-direction: row;
      height: 100vh;
      min-height: 400px;
      box-sizing: border-box;
    }
    .pane {
      flex: 1;
      padding: 2rem;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      background: #fff;
    }
    .pane.left {
      border-right: 1px solid #ececec;
      background: #f7f9fa;
    }
    .pane.right {
      background: #fff;
    }
    .pane label {
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: #2b2f33;
    }
    .pane textarea, .pane pre {
      flex: 1;
      width: 100%;
      min-height: 200px;
      resize: none;
      font-size: 1rem;
      font-family: 'JetBrains Mono', 'Fira Mono', 'Menlo', monospace;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      padding: 1rem;
      background: #f9fafb;
      box-sizing: border-box;
      outline: none;
      transition: border 0.2s;
    }
    .pane textarea:focus {
      border: 1.5px solid #4f8cff;
      background: #fff;
    }
    .pane pre {
      background: #f8f8fa;
      color: #23272e;
      overflow-x: auto;
      white-space: pre-wrap;
      word-break: break-all;
      margin: 0;
      min-height: 200px;
    }
    .error {
      color: #e03131;
      background: #fff3f3;
      border: 1px solid #ffcccc;
      padding: 0.5rem 1rem;
      border-radius: 5px;
      margin-top: 0.5rem;
      font-size: 0.98rem;
    }
    @media (max-width: 800px) {
      .container {
        flex-direction: column;
      }
      .pane {
        min-height: 40vh;
        padding: 1rem;
      }
      .pane.left {
        border-right: none;
        border-bottom: 1px solid #ececec;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="pane left">
      <label for="input">Input JS Object / JSON (malformed allowed):</label>
      <textarea id="input" spellcheck="false" placeholder="Paste JS object or JSON here...">{foo: 'bar', name: John, list: [ 1,2,3, ], extra: }</textarea>
    </div>
    <div class="pane right">
      <label for="output">Corrected &amp; Formatted Output:</label>
      <pre id="output"></pre>
      <div class="error" id="error" style="display: none;"></div>
    </div>
  </div>
  <script>
    // Heuristic fix for "object-like" JS input: 
    // - quotes unquoted keys, 
    // - single to double quotes, 
    // - removes trailing commas, 
    // - fixes colon after trailing comma, 
    // - removes extra commas/brackets.
    function fixMalformedJsObjectInput(input) {
      let s = input.trim();

      // Replace all single quotes with double quotes
      s = s.replace(/'/g, '"');

      // Remove trailing commas before } or ]
      s = s.replace(/,\s*([}\]])/g, '$1');

      // Remove extra trailing commas at end (could be after newlines)
      s = s.replace(/,(\s*[}\]])/g, '$1');

      // Remove empty entries in arrays: [1,2,,3] -> [1,2,3]
      s = s.replace(/,\s*,/g, ',');

      // Add double quotes to unquoted keys in objects (not inside strings)
      s = s.replace(
        /([{,]\s*)([a-zA-Z0-9_\-$]+)\s*:/g,
        '$1"$2":'
      );

      // Remove trailing colon (e.g. {foo:}) -- replace with null
      s = s.replace(/:\s*([}\]])/g, ':null$1');

      // Remove extra closing brackets/braces at end
      while ((s.match(/[}\]]/g) || []).length > (s.match(/[{[]/g) || []).length) {
        s = s.replace(/[\]}]$/, '');
      }

      // Try to wrap input with {} if it looks like a top-level object w/o braces
      if (
        !s.trim().startsWith('{') &&
        !s.trim().startsWith('[') &&
        s.includes(':')
      ) {
        s = '{' + s + '}';
      }

      return s;
    }

    function formatInput(input) {
      let fixed = fixMalformedJsObjectInput(input);
      let obj;
      try {
        obj = JSON.parse(fixed);
        return { result: JSON.stringify(obj, null, 2), error: null };
      } catch (jsonErr) {
        // Try using Function constructor as a last resort (dangerous, but here for rescue)
        try {
          // eslint-disable-next-line no-new-func
          obj = (new Function('return (' + input + ')'))();
          return { result: JSON.stringify(obj, null, 2), error: null };
        } catch (jsErr) {
          // Show both errors for debugging
          return { result: null, error: `Cannot parse input.\n\nJSON.parse error:\n${jsonErr.message}\n\nJS eval error:\n${jsErr.message}` };
        }
      }
    }

    const $input = document.getElementById('input');
    const $output = document.getElementById('output');
    const $error = document.getElementById('error');

    function process() {
      const input = $input.value;
      if (!input.trim()) {
        $output.textContent = '';
        $error.style.display = 'none';
        return;
      }
      const { result, error } = formatInput(input);
      if (result) {
        $output.textContent = result;
        $error.style.display = 'none';
      } else {
        $output.textContent = '';
        $error.textContent = error;
        $error.style.display = '';
      }
    }

    $input.addEventListener('input', process);

    // Initial process
    process();
  </script>
</body>
</html>