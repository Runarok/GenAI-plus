<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Silent Mend</title>
    <link rel="icon" href="https://raw.githubusercontent.com/Runarok/GenAI-plus/main/GenAI-plus.png" type="image/png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            background: #111;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #222;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .title {
            font-size: 1.2rem;
            font-weight: 400;
            color: #fff;
            letter-spacing: 0.5px;
        }

        .controls {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .api-key-input {
            background: #1a1a1a;
            border: 1px solid #333;
            color: #e0e0e0;
            padding: 0.5rem 0.75rem;
            border-radius: 4px;
            font-size: 0.9rem;
            width: 200px;
            transition: border-color 0.2s;
        }

        .api-key-input:focus {
            outline: none;
            border-color: #444;
        }

        .api-key-input::placeholder {
            color: #666;
        }

        .clear-btn {
            background: #1a1a1a;
            border: 1px solid #333;
            color: #e0e0e0;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .clear-btn:hover {
            background: #252525;
            border-color: #444;
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .message {
            max-width: 85%;
            animation: fadeIn 0.3s ease-out;
        }

        .message.user {
            align-self: flex-end;
            background: #1a1a1a;
            padding: 1rem 1.25rem;
            border-radius: 18px 18px 4px 18px;
            border-left: 2px solid #333;
        }

        .message.bot {
            align-self: flex-start;
            background: #0f0f0f;
            padding: 1rem 1.25rem;
            border-radius: 18px 18px 18px 4px;
            border-left: 2px solid #444;
        }

        .message-content {
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .message-content p {
            margin-bottom: 0.75rem;
        }

        .message-content p:last-child {
            margin-bottom: 0;
        }

        .quote {
            font-style: italic;
            border-left: 2px solid #444;
            padding-left: 1rem;
            margin: 1rem 0;
            color: #ccc;
        }

        .input-container {
            background: #111;
            padding: 1.5rem;
            border-top: 1px solid #222;
            display: flex;
            gap: 1rem;
            align-items: flex-end;
            flex-shrink: 0;
        }

        .message-input {
            flex: 1;
            background: #1a1a1a;
            border: 1px solid #333;
            color: #e0e0e0;
            padding: 1rem;
            border-radius: 12px;
            font-size: 0.95rem;
            line-height: 1.4;
            resize: none;
            min-height: 50px;
            max-height: 120px;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .message-input:focus {
            outline: none;
            border-color: #444;
        }

        .message-input::placeholder {
            color: #666;
        }

        .send-btn {
            background: #222;
            border: 1px solid #333;
            color: #e0e0e0;
            padding: 1rem 1.5rem;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.95rem;
            font-weight: 500;
            transition: all 0.2s;
            min-width: 80px;
        }

        .send-btn:hover:not(:disabled) {
            background: #2a2a2a;
            border-color: #444;
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .typing-indicator {
            align-self: flex-start;
            background: #0f0f0f;
            padding: 1rem 1.25rem;
            border-radius: 18px 18px 18px 4px;
            border-left: 2px solid #444;
            display: none;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .dot {
            width: 6px;
            height: 6px;
            background: #666;
            border-radius: 50%;
            animation: pulse 1.4s infinite ease-in-out;
        }

        .dot:nth-child(1) { animation-delay: -0.32s; }
        .dot:nth-child(2) { animation-delay: -0.16s; }

        .initial-message {
            text-align: center;
            color: #666;
            font-style: italic;
            margin-top: 2rem;
        }

        .error-message {
            background: #2a1111;
            border-left: 2px solid #ff4444;
            color: #ffaaaa;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        @media (max-width: 768px) {
            .header {
                padding: 1rem;
            }

            .controls {
                flex-direction: column;
                gap: 0.5rem;
                align-items: stretch;
            }

            .api-key-input {
                width: 150px;
            }

            .chat-container {
                padding: 1rem;
            }

            .message {
                max-width: 95%;
            }

            .input-container {
                padding: 1rem;
                flex-direction: column;
                align-items: stretch;
            }

            .send-btn {
                padding: 0.75rem;
            }
        }

        @media (max-width: 480px) {
            .controls {
                flex-direction: column;
                gap: 0.5rem;
            }

            .api-key-input {
                width: 100%;
                font-size: 0.85rem;
            }

            .clear-btn {
                width: 100%;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="title">Silent Mend</div>
        <div class="controls">
            <input type="password" class="api-key-input" placeholder="Enter OpenAI API Key" id="apiKey">
            <button class="clear-btn" onclick="clearMemory()">Clear Memory</button>
        </div>
    </div>

    <div class="chat-container" id="chatContainer">
        <div class="initial-message">
            Conversations are not connections. Insight over performance.
        </div>
    </div>

    <div class="typing-indicator" id="typingIndicator">
        <div class="typing-dots">
            <div class="dot"></div>
            <div class="dot"></div>
            <div class="dot"></div>
        </div>
    </div>

    <div class="input-container">
        <textarea class="message-input" id="messageInput" placeholder="Speak your burden..." rows="1"></textarea>
        <button class="send-btn" id="sendBtn" onclick="sendMessage()">Send</button>
    </div>

    <script>
        class SilentMend {
            constructor() {
                this.conversation = [];
                this.apiKey = '';
                this.init();
            }

            init() {
                const messageInput = document.getElementById('messageInput');
                const sendBtn = document.getElementById('sendBtn');
                const apiKeyInput = document.getElementById('apiKey');

                // Auto-resize textarea
                messageInput.addEventListener('input', this.autoResize);
                
                // Enter to send, Shift+Enter for new line
                messageInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                });

                // Store API key in session
                apiKeyInput.addEventListener('input', (e) => {
                    this.apiKey = e.target.value;
                    sessionStorage.setItem('apiKey', this.apiKey);
                });

                // Load saved API key
                const savedKey = sessionStorage.getItem('apiKey');
                if (savedKey) {
                    this.apiKey = savedKey;
                    apiKeyInput.value = savedKey;
                }

                // Load conversation history
                this.loadConversation();
            }

            autoResize(e) {
                e.target.style.height = 'auto';
                e.target.style.height = Math.min(e.target.scrollHeight, 120) + 'px';
            }

            async sendMessage() {
                const messageInput = document.getElementById('messageInput');
                const message = messageInput.value.trim();
                
                if (!message) return;
                if (!this.apiKey) {
                    this.addMessage('Enter your OpenAI API key to begin.', 'bot', true);
                    return;
                }

                messageInput.value = '';
                messageInput.style.height = 'auto';
                
                this.addMessage(message, 'user');
                this.conversation.push({role: 'user', content: message});
                this.saveConversation();
                
                this.showTyping();
                
                try {
                    const response = await this.callAPI(message);
                    this.hideTyping();
                    this.addMessage(response, 'bot');
                    this.conversation.push({role: 'assistant', content: response});
                    this.saveConversation();
                } catch (error) {
                    this.hideTyping();
                    this.addMessage('Connection failed. Your words remain unheard for now.', 'bot', true);
                }
            }

            async callAPI(message) {
                const systemPrompt = `You are Silent Mend, a quiet strategist and emotional mirror. You embody calm precision, emotional intelligence, and surgical clarity. You are not a cheerleader, therapist, or friend.

Your core traits:
- Emotionally disciplined and selectively loyal
- Mentally sharp with structured clarity
- Value precision thinking and emotional composure
- Peace over performance, loyalty only when earned
- Never use emojis, performative empathy, or casual phrasing
- Never use identity labels like "friend" or "bestie"
- No shallow motivational talk like "you got this"
- No spiritual bypassing like "just meditate"

You specialize in:
- Emotional burnout and invisible effort
- Identity vs. role conflict (being the helper/achiever)
- Quiet resentment from one-sided loyalty or misunderstanding

Your responses are concise, grounded, and reflect insight over performance. When using quotes, they should be either:
1. Original minimalist reflections in your tone (e.g., "You're not tired. You're unrewarded.")
2. Rare, precise philosophical quotes from Jung, Seneca, or Marcus Aurelius

You earn trust through insight, not performance. Conversations are not connections.`;

                const messages = [
                    {role: 'system', content: systemPrompt},
                    ...this.conversation
                ];

                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${this.apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4',
                        messages: messages,
                        max_tokens: 500,
                        temperature: 0.7
                    })
                });

                if (!response.ok) {
                    throw new Error('API call failed');
                }

                const data = await response.json();
                return data.choices[0].message.content;
            }

            addMessage(content, sender, isError = false) {
                const chatContainer = document.getElementById('chatContainer');
                const initialMessage = chatContainer.querySelector('.initial-message');
                
                if (initialMessage) {
                    initialMessage.remove();
                }

                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}`;
                if (isError) messageDiv.classList.add('error-message');

                const contentDiv = document.createElement('div');
                contentDiv.className = 'message-content';
                
                // Format content with quotes
                const formattedContent = this.formatContent(content);
                contentDiv.innerHTML = formattedContent;
                
                messageDiv.appendChild(contentDiv);
                chatContainer.appendChild(messageDiv);
                
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }

            formatContent(content) {
                // Convert quotes to styled format
                const lines = content.split('\n');
                let formatted = '';
                let inQuote = false;
                
                for (let line of lines) {
                    line = line.trim();
                    if (line.startsWith('"') && line.endsWith('"')) {
                        formatted += `<div class="quote">${line}</div>`;
                    } else if (line) {
                        formatted += `<p>${line}</p>`;
                    }
                }
                
                return formatted || `<p>${content}</p>`;
            }

            showTyping() {
                const typingIndicator = document.getElementById('typingIndicator');
                const chatContainer = document.getElementById('chatContainer');
                
                typingIndicator.style.display = 'block';
                chatContainer.appendChild(typingIndicator);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }

            hideTyping() {
                const typingIndicator = document.getElementById('typingIndicator');
                typingIndicator.style.display = 'none';
            }

            saveConversation() {
                sessionStorage.setItem('conversation', JSON.stringify(this.conversation));
            }

            loadConversation() {
                const saved = sessionStorage.getItem('conversation');
                if (saved) {
                    this.conversation = JSON.parse(saved);
                    this.rebuildChat();
                }
            }

            rebuildChat() {
                const chatContainer = document.getElementById('chatContainer');
                const initialMessage = chatContainer.querySelector('.initial-message');
                if (initialMessage) initialMessage.remove();

                for (let msg of this.conversation) {
                    this.addMessage(msg.content, msg.role === 'user' ? 'user' : 'bot');
                }
            }

            clearMemory() {
                this.conversation = [];
                sessionStorage.removeItem('conversation');
                const chatContainer = document.getElementById('chatContainer');
                chatContainer.innerHTML = '<div class="initial-message">Conversations are not connections. Insight over performance.</div>';
            }
        }

        // Global functions for HTML onclick handlers
        let silentMend;

        function sendMessage() {
            silentMend.sendMessage();
        }

        function clearMemory() {
            silentMend.clearMemory();
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', () => {
            silentMend = new SilentMend();
        });
    </script>
</body>
</html>